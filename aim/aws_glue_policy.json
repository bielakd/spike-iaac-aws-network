// Policy to allow AWS Glue to access all necessary resources
// TODO experiment with restricting an access further 
{
	"Version": "2012-10-17",
	"Statement":[
	{
		"Effect": "Allow",
		"Action": [
			"glue:*",
			"s3:GetBucketLocation",
			"s3:ListBucket",
			"s3:ListAllMyBuckets",
			"s3:GetBucketAcl",
			"ec2:DescribeVpcEndpoints",
			"ec2:DescribeRouteTables",
			"ec2:CreateNetworkInterface",
			"ec2:DeleteNetworkInterface",
			"ec2:DescribeNetworkInterfaces",
			"ec2:DescribeSecurityGroups",
			"ec2:DescribeSubnets",
			"ec2:DescribeVpcAttribute",
			"iam:ListRolePolicies",
			"iam:GetRole",
			"cloudwatch:PutMetricData"],
		"Resource":[
			"*"]
	},
	{	
		"EffectW":"Allow",
		"Action": [
			"s3:CreateBucket"
		],
		"Resource":[
			"arn:aws:s3:::icg-aws-glue-*"
		]
	},
	{
		"Effect": "Allow",
		"Action": [
			"s3:GetObject",
			"s3:PutObject",
			"s3:DeleteObject"
		],
		"Resource":[
			"arn:aws:s3:::icg-aws-glue-*/*",
			"arn:aws:s3:::*/*icg-aws-glue-*/*"
		]
	},
	{
		"Effect":"Allow",
		"Action":[
			"s3:GetObject"
		], 
		"Resource2":[
			"arn:aws:s3:::icg-crawler*",
			"arn:aws:s3:::icg-aws-glue-*"
		]
	},
	{
		"Effect":"Allow",
		"Action":[
			"logs:CreateLogGroup",
			"logs:CreateLogStream",
			"logs:PutLogsEvents",
			"logs:AssociateKmsKey"
		],
		"Resource":[
			"arn:aws:logs:*:*:/icg-aws-glue/*"
		]
	},
	{
		"Effect": "Allow",
		"Action":[
			"ec2:CreateTags",
			"ec2:DeleteTags"
		],
		"Condition":{
			"ForAllValues:StringEquals":{
				"aws:TagKeys":[
					"icg-aws-glue-svc-resources"
				]
			}
		},
		"Resource":[
			"arn:aws:ec2:*:*:network-interface/*",
			"arn:aws:ec2:*:*:security-group/*",
			"arn:aws:ec2:*:*:instance/*"
		]
	}
	]
}
